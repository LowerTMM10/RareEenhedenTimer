
<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dynamische Timer</title>
<style>
body {
  font-family: Arial, sans-serif;
  background-color: #f4f4f4;
  color: #333;
  width: 100vw;
  height: 100vh;
  margin: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  overflow: hidden;
}

.container {
  width: 100%;
  height: 100%;
  padding: 20px;
  background-color: #fff;
  box-sizing: border-box;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  position: relative;
}

h1 {
  color: #007BFF;
}

.timer-status {
  font-size: 1.2em;
  margin-top: 10px;
}

button {
  padding: 10px 20px;
  background-color: #6c757d;
  color: white;
  border: none;
  border-radius: 4px;
  font-size: 16px;
  cursor: pointer;
  transition: background-color 0.3s ease;
  margin-top: 20px;
}
button:hover {
  background-color: #5a6268;
}
  .yay-popup {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: 1000;
  opacity: 0;
  transition: opacity 0.2s ease-in-out;
  pointer-events: none; /* zorgt ervoor dat de overlay niet klikbaar is */
}

.yay-popup.show {
  opacity: 1;
}

.yay-popup img {
  width: 300px; /* Pas de grootte van de afbeelding aan */
  height: auto;
  border-radius: 10px;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
}
</style>
</head>
<body>

<div class="container">
  <h1>Dynamische Timer</h1>
  <p class="timer-status" id="statusText">De timer is ingesteld.</p>
  <button id="back-button">Terug</button>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const alarmSound = new Audio('https://rare-timer.netlify.app/assets/alarm.mp3'); 
    const statusElement = document.getElementById('statusText');
    const backButton = document.getElementById('back-button');
    let yayTimeoutId;

    // Cookie-functie
    function getCookie(name) {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            let cookie = cookies[i].trim();
            if (cookie.startsWith(name + '=')) return cookie.substring(name.length + 1);
        }
        return null;
    }
    
    const timerDurationValue = getCookie('TimerDuur');
    const minutes = parseInt(timerDurationValue, 10);
    
    if (timerDurationValue === null || isNaN(minutes)) {
        statusElement.textContent = 'Fout: De "TimerDuur" cookie is niet gevonden of is geen geldig getal.';
        console.error('Cookie "TimerDuur" is niet gevonden of is geen geldig getal.');
        return;
    } 
    
    const totalSeconds = minutes * 60;
    let remainingSeconds = totalSeconds;
    let startTime = Date.now();
    
    // Functie voor de timer-weergave
    function updateTimer() {
        if (remainingSeconds < 0) {
            statusElement.textContent = 'De tijd is op!';
            alarmSound.play();
            return;
        }

        const displayMinutes = Math.floor(remainingSeconds / 60);
        const displaySeconds = remainingSeconds % 60;
        const paddedSeconds = displaySeconds.toString().padStart(2, '0');
        statusElement.textContent = `Nog ${displayMinutes}:${paddedSeconds} te gaan!`;

        remainingSeconds--;
        setTimeout(updateTimer, 1000);
    }

    // Functie voor het versnellende geluidseffect
// Functie voor het versnellende geluidseffect en de pop-up
function playYaySound() {
    const elapsedTime = (Date.now() - startTime) / 1000;
    
    // Zorg dat de geluidslus stopt als de timer op is
    if (elapsedTime >= totalSeconds - 0.1) {
        return;
    }
    
    // Bepaal de vertraging per fase
    let yayDelay;
    if (remainingSeconds > 30) {
        yayDelay = 30000;
    } else if (remainingSeconds > 1) {
        const startNode = 30;
        const endNode = 1;
        const totalSegmentTime = startNode - endNode;
        const timeInSegment = startNode - remainingSeconds;
        const segmentProgress = timeInSegment / totalSegmentTime;

        const startDelay = 1000;
        const endDelay = 200;
        yayDelay = startDelay - (startDelay - endDelay) * segmentProgress;
    } else {
        const startDelay = 200;
        const endDelay = 50;
        const timeInSegment = 1 - remainingSeconds;
        const segmentProgress = timeInSegment;
        yayDelay = startDelay - (startDelay - endDelay) * segmentProgress;
    }

    // Speel het geluid af en toon de pop-up
    const yaySoundInstance = new Audio('https://rare-timer.netlify.app/assets/yay.mp3');
    yaySoundInstance.play();
    showYayPopup();

    yayTimeoutId = setTimeout(playYaySound, yayDelay);
}

// Nieuwe functie om de pop-up te tonen en te verbergen
function showYayPopup() {
    const popup = document.createElement('div');
    popup.classList.add('yay-popup');
    
    const img = document.createElement('img');
    img.src = 'https://rare-timer.netlify.app/assets/yay.jpg';
    img.alt = 'Yay!';
    
    popup.appendChild(img);
    document.body.appendChild(popup);
    
    // Toon de pop-up na een kleine vertraging
    setTimeout(() => {
        popup.classList.add('show');
    }, 10);
    
    // Verwijder de pop-up na 0.5 seconden
    setTimeout(() => {
        popup.classList.remove('show');
        // Verwijder het element volledig uit de DOM na de fade-out animatie
        setTimeout(() => {
            document.body.removeChild(popup);
        }, 200); // 500ms komt overeen met de CSS transition-duur
    }, 100); // Tijd dat de pop-up zichtbaar is voordat hij begint te faden
}
    
    // Start de timers
    statusElement.textContent = `De timer is ingesteld op ${minutes} minuut${minutes === 1 ? '' : 'en'}.`;
    updateTimer(); 
    playYaySound(); 
    
    backButton.addEventListener('click', () => window.history.back());
});
</script>

</body>
</html>
