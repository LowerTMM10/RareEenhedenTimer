<div class="container">
    <h1>Normale timer</h1>
    <p class="timer-status" id="statusText">De timer is ingesteld.</p>
    <button id="back-button">Terug</button>
    <!-- Random trein -->
    <img id="train" src="" alt="Trein" style="position:absolute; top:70%; left:-607px; width:607px; height:78px; display:none;">
</div>

<script>
document.addEventListener('DOMContentLoaded', (event) => {
    const soundUrl = 'assets/alarm.mp3'; 
    const statusElement = document.getElementById('statusText');
    const backButton = document.getElementById('back-button');
    const audio = new Audio(soundUrl);
    const train = document.getElementById('train');

    const trains = ['assets/virm.png', 'assets/icng.png', 'assets/icm.png'];

    function getCookie(name) {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            let cookie = cookies[i].trim();
            if (cookie.startsWith(name + '=')) {
                return cookie.substring(name.length + 1);
            }
        }
        return null;
    }

    const timerDurationValue = getCookie('TimerDuur');
    const minutes = parseInt(timerDurationValue, 10);

    if (timerDurationValue === null || isNaN(minutes)) {
        statusElement.textContent = 'Fout: De "TimerDuur" cookie is niet gevonden of is geen geldig getal.';
        console.error('Cookie "TimerDuur" is niet gevonden of is geen geldig getal.');
    } else {
        const totalSeconds = minutes * 60;
        let remainingSeconds = totalSeconds;

        statusElement.textContent = `De timer is ingesteld op ${minutes} minuut${minutes === 1 ? '' : 'en'}.`;

        const timerInterval = setInterval(() => {
            remainingSeconds--;

            // Willekeurige trein laten verschijnen met 10% kans per seconde
            if (Math.random() < 0.1) {
                const randomTrain = trains[Math.floor(Math.random() * trains.length)];
                train.src = randomTrain;
                train.style.left = '-607px';
                train.style.display = 'block';

                let trainPos = -607;
                const trainInterval = setInterval(() => {
                    trainPos += 10; // snelheid van de trein
                    train.style.left = trainPos + 'px';
                    if (trainPos > window.innerWidth) {
                        clearInterval(trainInterval);
                        train.style.display = 'none';
                    }
                }, 20);
            }

            if (remainingSeconds < 0) {
                clearInterval(timerInterval);
                
                audio.play().then(() => {
                    alert('De timer van ' + minutes + ' minuten is klaar!');
                }).catch(error => {
                    console.error('Fout bij het afspelen van het geluid:', error);
                    alert('De timer van ' + minutes + ' minuten is klaar! (Kon geluid niet afspelen)');
                });

            }
        }, 1000);
    }

    backButton.addEventListener('click', () => {
        window.history.back();
    });
});
</script>
