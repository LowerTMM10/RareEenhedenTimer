<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Timer met geluid</title>
<style>
body {
  font-family: Arial, sans-serif;
  background-color: #f4f4f4;
  color: #333;
  width: 100vw;
  height: 100vh;
  margin: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  overflow: hidden;
}

.container {
  width: 100%;
  height: 100%;
  padding: 20px;
  background-color: #fff;
  box-sizing: border-box;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  position: relative;
}

h1 {
  color: #007BFF;
}

.timer-status {
  font-size: 1.2em;
  margin-top: 10px;
}

button {
  padding: 10px 20px;
  background-color: #6c757d;
  color: white;
  border: none;
  border-radius: 4px;
  font-size: 16px;
  cursor: pointer;
  transition: background-color 0.3s ease;
  margin-top: 20px;
}
button:hover {
  background-color: #5a6268;
}
</style>
</head>
<body>

<div class="container">
  <h1>Dynamische Timer</h1>
  <p class="timer-status" id="statusText">De timer is ingesteld.</p>
  <button id="back-button">Terug</button>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const alarmSound = new Audio('assets/alarm.mp3'); 
    const yaySound = new Audio('assets/yay.mp3'); 
    const statusElement = document.getElementById('statusText');
    const backButton = document.getElementById('back-button');
    
    // Cookie-functie
    function getCookie(name) {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            let cookie = cookies[i].trim();
            if (cookie.startsWith(name + '=')) return cookie.substring(name.length + 1);
        }
        return null;
    }
    
    const timerDurationValue = getCookie('TimerDuur');
    const minutes = parseInt(timerDurationValue, 10);
    
    if (timerDurationValue === null || isNaN(minutes)) {
        statusElement.textContent = 'Fout: De "TimerDuur" cookie is niet gevonden of is geen geldig getal.';
        console.error('Cookie "TimerDuur" is niet gevonden of is geen geldig getal.');
        return; // Stop de scriptuitvoering
    } 
    
    const totalSeconds = minutes * 60;
    let remainingSeconds = totalSeconds;
    
    // Functie voor de timer en het geluid
    function updateTimer() {
        remainingSeconds--;
        
        // Bereken de voortgang van de timer (0.0 aan het begin, 1.0 aan het einde)
        const progress = 1 - (remainingSeconds / totalSeconds);
        
        // Verhoog de kans dat het 'yay'-geluid verschijnt
        const yayChance = 0.1 + 0.9 * progress;
        
        if (remainingSeconds >= 0) {
            // Speel 'yay'-geluid met toenemende frequentie
            if (Math.random() < yayChance) {
                yaySound.play();
            }

            // Update de status-tekst
            const displayMinutes = Math.floor(remainingSeconds / 60);
            const displaySeconds = remainingSeconds % 60;
            const paddedSeconds = displaySeconds.toString().padStart(2, '0');
            statusElement.textContent = `Nog ${displayMinutes}:${paddedSeconds} te gaan!`;
            
            // Loop de functie na een kortere of langere pauze
            const newDelay = 1000 - 800 * progress; // Vanaf 1000ms naar 200ms
            setTimeout(updateTimer, newDelay);
        } else {
            // Timer is klaar
            statusElement.textContent = 'De tijd is op!';
            alarmSound.play();
        }
    }
    
    // Start de timer
    statusElement.textContent = `De timer is ingesteld op ${minutes} minuut${minutes === 1 ? '' : 'en'}.`;
    setTimeout(updateTimer, 1000);
    
    backButton.addEventListener('click', () => window.history.back());
});
</script>

</body>
</html>
