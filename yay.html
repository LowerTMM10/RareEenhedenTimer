<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dynamische Timer</title>
<style>
body {
  font-family: Arial, sans-serif;
  background-color: #f4f4f4;
  color: #333;
  width: 100vw;
  height: 100vh;
  margin: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  overflow: hidden;
}

.container {
  width: 100%;
  height: 100%;
  padding: 20px;
  background-color: #fff;
  box-sizing: border-box;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  position: relative;
}

h1 {
  color: #007BFF;
}

.timer-status {
  font-size: 1.2em;
  margin-top: 10px;
}

button {
  padding: 10px 20px;
  background-color: #6c757d;
  color: white;
  border: none;
  border-radius: 4px;
  font-size: 16px;
  cursor: pointer;
  transition: background-color 0.3s ease;
  margin-top: 20px;
}
button:hover {
  background-color: #5a6268;
}
</style>
</head>
<body>

<div class="container">
  <h1>Dynamische Timer</h1>
  <p class="timer-status" id="statusText">De timer is ingesteld.</p>
  <button id="back-button">Terug</button>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const alarmSound = new Audio('assets/alarm.mp3'); 
    const yaySound = new Audio('assets/yay.mp3'); 
    const statusElement = document.getElementById('statusText');
    const backButton = document.getElementById('back-button');
    
    // Cookie-functie
    function getCookie(name) {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            let cookie = cookies[i].trim();
            if (cookie.startsWith(name + '=')) return cookie.substring(name.length + 1);
        }
        return null;
    }
    
    const timerDurationValue = getCookie('TimerDuur');
    const minutes = parseInt(timerDurationValue, 10);
    
    if (timerDurationValue === null || isNaN(minutes)) {
        statusElement.textContent = 'Fout: De "TimerDuur" cookie is niet gevonden of is geen geldig getal.';
        console.error('Cookie "TimerDuur" is niet gevonden of is geen geldig getal.');
        return;
    } 
    
    const totalSeconds = minutes * 60;
    let remainingSeconds = totalSeconds;
    let startTime = Date.now();

    // Functie voor de timer-weergave
    function updateTimer() {
        if (remainingSeconds < 0) {
            statusElement.textContent = 'De tijd is op!';
            alarmSound.play();
            return;
        }

        const displayMinutes = Math.floor(remainingSeconds / 60);
        const displaySeconds = remainingSeconds % 60;
        const paddedSeconds = displaySeconds.toString().padStart(2, '0');
        statusElement.textContent = `Nog ${displayMinutes}:${paddedSeconds} te gaan!`;

        remainingSeconds--;
        setTimeout(updateTimer, 1000);
    }

    // Functie voor het versnellende geluidseffect
    function playYaySound() {
        const elapsedTime = (Date.now() - startTime) / 1000; // Verstreken tijd in seconden
        
        // Zorg dat de geluidslus stopt als de timer op is
        if (elapsedTime >= totalSeconds) {
            return;
        }
        
        // Bereken de voortgang (van 0.0 aan het begin tot 1.0 aan het einde)
        const progress = elapsedTime / totalSeconds;
        
        // Speel het geluid af
        yaySound.play();

        // De vertraging daalt exponentieel van 2000ms naar 50ms
        const startDelay = 2000;
        const endDelay = 50;
        const yayDelay = startDelay * Math.pow(endDelay / startDelay, progress);

        setTimeout(playYaySound, yayDelay);
    }
    
    // Start de timers
    statusElement.textContent = `De timer is ingesteld op ${minutes} minuut${minutes === 1 ? '' : 'en'}.`;
    updateTimer(); 
    playYaySound(); 
    
    backButton.addEventListener('click', () => window.history.back());
});
</script>

</body>
</html>
