<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Toeren Timer</title>
    <style>
body {
  font-family: Arial, sans-serif;
  background-color: #f4f4f4;
  color: #333;
  margin: 0;
  text-align: center;
  width: auto;
}

.container {
  width: 100%;
  height: 50%;
  padding: 20px;
  background-color: #fff;
  box-sizing: border-box;
  display: flex;
  flex-direction: column;
  justify-content: center; /* inhoud in het midden */
  align-items: center;
}


        h1 {
            color: #007BFF;
        }
        .timer-status {
            font-size: 1.2em;
            margin-top: 10px;
        }
        
        /* Stijlen voor de wijzer en de wijzerplaat */
#gauge-container {
  position: relative;
  margin: 20px auto;
  display: inline-block;   /* container krimpt mee met de bg-afbeelding */
}

#gauge-bg {
  display: block;
  width: 100%; 
  height: auto;            /* behoudt juiste verhoudingen */
}

#gauge-pointer {
  position: absolute;
  left: 50%;
  bottom: 0;
  height: 45%;             /* naaldhoogte t.o.v. container */
  width: auto;
  transform-origin: center bottom;
  transition: transform 0.2s linear;
  --angle: 0deg;
  transform: rotate(calc(var(--angle) - 90deg));
}


        button {
            padding: 10px 20px;
            background-color: #6c757d;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            margin-top: 20px;
        }
        button:hover {
            background-color: #5a6268;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Timer voor de Toeren</h1>
    <p class="timer-status" id="statusText">De timer is ingesteld.</p>

    <div id="gauge-container">
        <img id="gauge-bg" src="assets/background.png" alt="Wijzerplaat">
        <img id="gauge-pointer" src="assets/indicator.png" alt="Wijzer">
    </div>

    <button id="back-button">Terug</button>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const soundUrl = 'assets/alarm.mp3';
  const statusElement = document.getElementById('statusText');
  const backButton = document.getElementById('back-button');
  const audio = new Audio(soundUrl);
  const gaugePointer = document.getElementById('gauge-pointer');

  function getCookie(name){
    const cookieString = document.cookie;
    const cookies = cookieString.split(';');
    for (let i = 0; i < cookies.length; i++) {
      let cookie = cookies[i].trim();
      if (cookie.startsWith(name + '=')) {
        return cookie.substring(name.length + 1);
      }
    }
    return null;
  }

  const timerDurationValue = getCookie('TimerDuur');
  const minutes = parseInt(timerDurationValue, 10);

  if (timerDurationValue === null || isNaN(minutes)) {
    statusElement.textContent = 'Fout: De "TimerDuur" cookie is niet gevonden of is geen geldig getal.';
    console.error('Cookie "TimerDuur" is niet gevonden of is geen geldig getal.');
  } else {
    const totalSeconds = minutes * 60;
    let remainingSeconds = totalSeconds;

    statusElement.textContent = `De timer is ingesteld op ${minutes} minuut${minutes === 1 ? '' : 'en'}.`;

    // Start op 0Â°
    gaugePointer.style.setProperty('--angle', '0deg');

    const timerInterval = setInterval(() => {
      remainingSeconds--;

      const rotationDegrees = (180 / totalSeconds) * (totalSeconds - remainingSeconds);
      gaugePointer.style.setProperty('--angle', `${rotationDegrees}deg`);

      if (remainingSeconds < 0) {
        clearInterval(timerInterval);

        audio.play().then(() => {
          alert('De timer van ' + minutes + ' minuten is klaar!');
        }).catch(error => {
          console.error('Fout bij het afspelen van het geluid:', error);
          alert('De timer van ' + minutes + ' minuten is klaar! (Kon geluid niet afspelen)');
        });

        statusElement.textContent = 'De timer is klaar!';
        gaugePointer.style.setProperty('--angle', '180deg');
      }
    }, 1000);
  } // <-- deze sloot je else af; die miste je
  backButton.addEventListener('click', () => window.history.back());
});
</script>

</body>
</html>
